<main
  class="flex flex-col items-center justify-center min-h-screen p-4"
  style="background: var(--bg)"
>
  <section
    class="w-full max-w-sm rounded-lg shadow-[0_4px_6px_-4px_rgba(0,0,0,0.1),0_10px_15px_-3px_rgba(0,0,0,0.1)] px-10 py-10 lg:flex lg:max-w-4xl overflow-hidden"
    style="background: var(--surface)"
  >
    <div class="w-full lg:w-2/2 flex flex-col justify-center">
      <div class="text-center mb-6">
        <img
          src="/images/logos/ginebro-logo.png"
          alt="Ginebro Logo"
          class="mx-auto h-12 mb-2"
        />
        <h2
          class="text-[20.4px] font-bold leading-8 font-sans"
          style="color: var(--primary)"
        >
          Recuperar contrasenya
        </h2>
        <p
          class="text-sm leading-6 font-sans"
          style="color: var(--text-secondary)"
        >
          Introdueix el teu correu per rebre un codi de verificació
        </p>
      </div>

      <form
        *ngIf="step === 1"
        [formGroup]="emailForm"
        (ngSubmit)="sendResetCode()"
        class="flex flex-col gap-6"
      >
        <div class="flex flex-col gap-1">
          <label
            class="text-xs font-medium font-sans"
            style="color: var(--text-secondary)"
          >
            Correu electrònic
          </label>
          <input
            formControlName="email"
            type="email"
            placeholder="Introdueix el teu correu"
            class="w-full h-[41px] px-3 py-2 rounded-md border text-base font-sans focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>
        <button
          type="submit"
          [disabled]="isSubmitting"
          class="w-full h-10 text-white text-sm font-semibold rounded-md transition"
          style="background: var(--primary)"
        >
          {{ isSubmitting ? "Enviant..." : "Enviar codi" }}
        </button>
      </form>

      <form
        *ngIf="step === 2"
        [formGroup]="resetForm"
        (ngSubmit)="resetPassword()"
        class="flex flex-col gap-6"
      >
        <div class="text-center">
          <label
            class="text-xs font-medium font-sans mb-2 block"
            style="color: var(--text-secondary)"
          >
            Codi de verificació
          </label>
          <app-otp-input
            [length]="6"
            (codeChange)="resetForm.get('code')?.setValue($event)"
          ></app-otp-input>
        </div>

        <div class="flex flex-col gap-1">
          <label
            class="text-xs font-medium font-sans"
            style="color: var(--text-secondary)"
          >
            Nova contrasenya
          </label>
          <input
            formControlName="password"
            type="password"
            placeholder="Nova contrasenya"
            class="w-full h-[41px] px-3 py-2 rounded-md border text-base font-sans focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
          <app-password-strength
            [password]="resetForm.get('password')?.value || ''"
            (strengthChange)="passwordValid = $event"
          ></app-password-strength>
        </div>

        <div class="flex flex-col gap-1">
          <label
            class="text-xs font-medium font-sans"
            style="color: var(--text-secondary)"
          >
            Confirmació de contrasenya
          </label>
          <input
            formControlName="password_confirmation"
            type="password"
            placeholder="Repeteix la contrasenya"
            class="w-full h-[41px] px-3 py-2 rounded-md border text-base font-sans focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>

        <button
          type="submit"
          [disabled]="isSubmitting || !passwordValid || resetForm.invalid"
          class="w-full h-10 text-white text-sm font-semibold rounded-md transition"
          style="background: var(--primary)"
        >
          {{ isSubmitting ? "Restablint..." : "Restablir contrasenya" }}
        </button>
      </form>
    </div>
  </section>
</main>
