<main
  class="flex items-center justify-center min-h-screen px-4 font-sans"
  style="background: var(--bg)"
>
  <section
    class="w-full max-w-sm lg:max-w-md rounded-lg shadow-[0_4px_4px_rgba(0,0,0,0.25),0_4px_6px_-4px_rgba(0,0,0,0.1),0_10px_15px_-3px_rgba(0,0,0,0.1),0_-10px_15px_rgba(0,0,0,0.1)]"
    style="background: var(--surface)"
  >
    <header class="flex flex-col items-center pt-8 pb-6 text-center">
      <h1
        class="text-[20.4px] font-bold leading-8"
        style="color: var(--primary)"
      >
        Registre d’Estudiant
      </h1>
      <p class="text-sm leading-6" style="color: var(--text-secondary)">
        Sistema de Menjador Escolar
      </p>
    </header>

    <form
      *ngIf="step === 1"
      [formGroup]="emailForm"
      (ngSubmit)="sendCode()"
      class="px-10 pb-6 flex flex-col gap-6"
    >
      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium" style="color: var(--text-secondary)">
          Correu electrònic
        </label>
        <div class="relative">
          <app-icon
            name="email"
            class="absolute left-3 top-2.5 w-5 h-5"
            style="color: var(--text-muted)"
          ></app-icon>
          <input
            type="email"
            formControlName="email"
            placeholder="el@teu.email"
            class="w-full h-[41px] pl-10 pr-3 py-2 rounded-md border text-base focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>
      </div>

      <button
        type="submit"
        class="w-full h-10 text-white text-sm font-medium rounded-md flex items-center justify-center gap-2 transition"
        style="background: var(--primary)"
        [disabled]="emailForm.invalid || isSubmitting"
      >
        <app-icon name="add-user" class="w-5 h-5"></app-icon>
        <span *ngIf="!isSubmitting">Enviar codi</span>
        <span *ngIf="isSubmitting">Enviant...</span>
      </button>

      <div
        *ngIf="
          emailForm.get('email')?.touched && emailForm.get('email')?.errors
        "
        class="text-sm"
        style="color: var(--danger)"
      >
        <small *ngIf="emailForm.get('email')?.errors?.['required']">
          El correu és obligatori.
        </small>
        <small *ngIf="emailForm.get('email')?.errors?.['email']">
          Format de correu no vàlid.
        </small>
        <small *ngIf="emailForm.get('email')?.errors?.['ginebroEmail']">
          Només es permeten correus ginebro.cat.
        </small>
      </div>
    </form>

    <form
      *ngIf="step === 2"
      [formGroup]="registerForm"
      (ngSubmit)="onSubmit()"
      class="px-10 pb-6 flex flex-col gap-6"
    >
      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium" style="color: var(--text-secondary)">
          Nom
        </label>
        <div class="relative">
          <app-icon
            name="user"
            class="absolute left-3 top-2.5 w-5 h-5"
            style="color: var(--text-muted)"
          ></app-icon>
          <input
            type="text"
            formControlName="name"
            placeholder="El teu nom"
            class="w-full h-[41px] pl-10 pr-3 py-2 rounded-md border text-base focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>
      </div>

      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium" style="color: var(--text-secondary)">
          Cognoms
        </label>
        <div class="relative">
          <app-icon
            name="user"
            class="absolute left-3 top-2.5 w-5 h-5"
            style="color: var(--text-muted)"
          ></app-icon>
          <input
            type="text"
            formControlName="last_name"
            placeholder="Els teus cognoms"
            class="w-full h-[41px] pl-10 pr-3 py-2 rounded-md border text-base focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>
      </div>

      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium" style="color: var(--text-secondary)">
          Codi de verificació
        </label>
        <app-otp-input
          (codeChange)="registerForm.get('verification_code')?.setValue($event)"
        ></app-otp-input>
      </div>

      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium" style="color: var(--text-secondary)">
          Contrasenya
        </label>
        <div class="relative">
          <app-icon
            name="lock"
            class="absolute left-3 top-2.5 w-5 h-5"
            style="color: var(--text-muted)"
          ></app-icon>
          <input
            type="password"
            formControlName="password"
            placeholder="La teva contrasenya"
            class="w-full h-[41px] pl-10 pr-3 py-2 rounded-md border text-base focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>
      </div>

      <app-password-strength
        [password]="passwordValue"
        (strengthChange)="passwordValid = $event"
      ></app-password-strength>

      <div class="flex flex-col gap-1">
        <label class="text-xs font-medium" style="color: var(--text-secondary)">
          Confirma la Contrasenya
        </label>
        <div class="relative">
          <app-icon
            name="lock"
            class="absolute left-3 top-2.5 w-5 h-5"
            style="color: var(--text-muted)"
          ></app-icon>
          <input
            type="password"
            formControlName="password_confirmation"
            placeholder="Introduïu la contrasenya de nou"
            class="w-full h-[41px] pl-10 pr-3 py-2 rounded-md border text-base focus:outline-none focus:ring-2"
            style="
              border-color: var(--border);
              color: var(--text-primary);
              --tw-ring-color: var(--primary);
            "
          />
        </div>
      </div>

      <small
        *ngIf="registerForm.errors?.['passwordsMismatch']"
        style="color: var(--danger)"
      >
        Les contrasenyes no coincideixen.
      </small>

      <button
        type="submit"
        class="w-full h-10 text-white text-sm font-medium rounded-md flex items-center justify-center gap-2 transition"
        style="background: var(--primary)"
        [disabled]="registerForm.invalid || isSubmitting"
      >
        <app-icon name="add-user" class="w-5 h-5"></app-icon>
        <span *ngIf="!isSubmitting">Completar registre</span>
        <span *ngIf="isSubmitting">Registrant...</span>
      </button>
    </form>

    <a
      href="#"
      class="text-sm font-normal text-center block pb-6 hover:underline"
      style="color: var(--primary)"
      (click)="navigateToLogin(); $event.preventDefault()"
    >
      Ja tens compte? Inicia sessió
    </a>
  </section>
</main>
